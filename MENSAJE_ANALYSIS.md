# AnÃ¡lisis de Plantilla de Mensajes - Activo MÃ¡s Inversiones

## Problemas Identificados en Mensajes Actuales

### 1. **Mensaje Inicial (Muy Largo - 203 palabras)**
âŒ Demasiada informaciÃ³n de golpe
âŒ Requisitos muy adelante abruman al lead
âŒ No invita a conversaciÃ³n natural
âŒ Puede generar rechazo inmediato

### 2. **Falta de Estructura Conversacional**
âŒ No sigue principio "una cosa a la vez"
âŒ No valida interÃ©s antes de pedir datos
âŒ No personaliza segÃºn respuestas

### 3. **Tono Inconsistente**
âŒ Mezcla formal e informal
âŒ Uso excesivo de emojis en algunos mensajes
âŒ Falta naturalidad

---

## MENSAJES MEJORADOS (Conversacionales y Cortos)

### ğŸ“© **1. Mensaje Inicio ConversaciÃ³n**

**ANTES (203 palabras):**
```
Hola "Cliente" cÃ³mo estÃ¡s? Soy â€¦. de Activo MÃ¡s Inversiones.

Te escribo porque completaste un formulario para conocer opciones de inversiÃ³n en departamentos, y querÃ­a invitarte a una asesorÃ­a gratuita y 100% personalizada (por videollamada), donde un experto te ayudarÃ¡ a encontrar los proyectos que realmente se ajustan a tu perfil, tus objetivos y capacidad crediticia.

AdemÃ¡s, en este momento hay condiciones muy favorables para invertir, como Bono Pie 0 y el subsidio al dividendo, que entrega un apoyo mensual para el pago del crÃ©dito hipotecario. Es una tremenda oportunidad para partir con el pie derecho ğŸš€

Para acceder, necesitas:
âœ… No estar en DICOM (mÃ­nimo 1 aÃ±o)
âœ… Contrato indefinido (+3 meses) o 2 aÃ±os con boletas
âœ… Renta lÃ­quida desde $1.400.000
âœ… Estar bancarizado (cuenta corriente con lÃ­nea de crÃ©dito)
*Si eres extranjero, contar con visa definitiva

Â¿Te gustarÃ­a agendar y revisar tus opciones con un experto?
Quedo atento ğŸ˜Š
```

**DESPUÃ‰S (VersiÃ³n A - 45 palabras):**
```
Â¡Hola {nombre}! Soy {agente} de Activo MÃ¡s ğŸ‘‹

Vi que te interesa invertir en departamentos. Justo ahora hay condiciones muy buenas con Bono Pie 0.

Â¿Te gustarÃ­a saber si calificas para una asesorÃ­a gratuita? Es 100% personalizada.
```

**DESPUÃ‰S (VersiÃ³n B - MÃ¡s directa, 35 palabras):**
```
Hola {nombre}, Â¿cÃ³mo estÃ¡s? Soy {agente} de Activo MÃ¡s.

Completaste el formulario sobre inversiÃ³n en departamentos. Â¿Sigues buscando opciones?

Te cuento que hay beneficios vigentes (Bono Pie 0, subsidio dividendo).
```

---

### ğŸ“© **2. ValidaciÃ³n de InterÃ©s (NUEVO - Antes de pedir requisitos)**

```
Perfecto! DÃ©jame contarte rÃ¡pido: ofrecemos asesorÃ­a personalizada (videollamada) donde revisamos proyectos que se ajusten a tu perfil.

En este momento hay condiciones favorables como Bono Pie 0 y subsidio al dividendo.

Â¿Te interesa revisar si calificas?
```

---

### ğŸ“© **3. Consulta de Requisitos (MEJORADO - Paso a Paso)**

**ANTES (Todo de golpe):**
```
Para acceder, necesitas:
âœ… No estar en DICOM (mÃ­nimo 1 aÃ±o)
âœ… Contrato indefinido (+3 meses) o 2 aÃ±os con boletas
âœ… Renta lÃ­quida desde $1.400.000
âœ… Estar bancarizado (cuenta corriente con lÃ­nea de crÃ©dito)
```

**DESPUÃ‰S (Conversacional, uno por uno):**

**Paso 1:**
```
Excelente. Para ver si calificas, necesito hacerte algunas preguntas rÃ¡pidas.

Primera: Â¿EstÃ¡s en DICOM actualmente?
```

**Paso 2 (Si dice "no"):**
```
Perfecto ğŸ‘Œ 

Â¿QuÃ© tipo de contrato tienes? (indefinido, a plazo, boletas)
```

**Paso 3:**
```
Bien. Â¿CuÃ¡l es tu renta lÃ­quida mensual aproximada?
```

**Paso 4:**
```
Genial. Â¿Tienes cuenta corriente con lÃ­nea de crÃ©dito? (bancarizado)
```

**Paso 5 (Si es extranjero):**
```
Ãšltima consulta: Â¿Tienes visa definitiva?
```

---

### ğŸ“© **4. Carga Financiera (MEJORADO)**

**ANTES (Todo junto):**
```
- Â¿EstÃ¡s pagando algÃºn crÃ©dito (consumo, hipotecario o automotriz)? Â¿Monto mensual?
- Renta lÃ­quida.
- Edad.
- A quÃ© te dedicas.
- Buscas para vivir o invertir.
- Cuentas con ahorros en caso de que te guste algÃºn proyecto.
```

**DESPUÃ‰S (Paso a paso):**

```
Perfecto {nombre}, cumples con los requisitos bÃ¡sicos ğŸ‘

Para preparar tu asesorÃ­a personalizada, necesito algunos datos mÃ¡s:

1ï¸âƒ£ Â¿EstÃ¡s pagando algÃºn crÃ©dito actualmente? (consumo/hipotecario/auto)
```

Esperar respuesta, luego:

```
2ï¸âƒ£ Â¿CuÃ¡ntos aÃ±os tienes?
```

```
3ï¸âƒ£ Â¿A quÃ© te dedicas?
```

```
4ï¸âƒ£ Â¿Buscas para vivir o para invertir?
```

```
5ï¸âƒ£ Â¿Cuentas con ahorros para pie/gastos iniciales?
```

---

### ğŸ“© **5. Mensaje Agendar (MEJORADO)**

**ANTES:**
```
Excelente Daniela cumples con todos los requisitos y ademÃ¡s tienes la capacidad crediticia para optar a los proyectos con *Bono pie 0*. Ahora, lo siguiente es agendar tu asesorÃ­a, la cual se realizarÃ¡ a travÃ©s de una videollamada (Idealmente que te conectes desde un computador).  Tengo disponibilidad para hoy entre las 12:00 y las 17:00 hrs. Â¿QuÃ© horario te acomoda?
```

**DESPUÃ‰S:**
```
Â¡Excelente {nombre}! ğŸ‰

Cumples con todos los requisitos y tienes capacidad crediticia para proyectos con Bono Pie 0.

Agendemos tu asesorÃ­a (videollamada). Horarios disponibles hoy:
â€¢ 12:00 hrs
â€¢ 14:00 hrs
â€¢ 16:00 hrs
â€¢ 17:00 hrs

Â¿CuÃ¡l te acomoda? (Idealmente conÃ©ctate desde PC/notebook)
```

---

### ğŸ“© **6. Cliente No Responde (MEJORADO)**

**ANTES:**
```
Â¡Hola "NOMBRE"! Â¿CÃ³mo estÃ¡s? Soy "Nombre Telemarketing". Â¿Te vendrÃ­a bien que te llame en algÃºn momento del dÃ­a? AvÃ­same para saber si realmente estÃ¡s interesada en el tema de inversiÃ³n en departamentos. Â¡Gracias!
```

**DESPUÃ‰S:**
```
Hola {nombre} ğŸ‘‹

Vi que dejaste la conversaciÃ³n a medias. Â¿Sigue vigente tu interÃ©s en invertir?

Si prefieres, podemos coordinar una llamada rÃ¡pida. Â¿Te viene bien?
```

---

### ğŸ“© **7. ConfirmaciÃ³n Agendamiento WhatsApp (MEJORADO)**

**ANTES:**
```
Hola "NOMBRE" Â¿CÃ³mo estÃ¡s?
Tu asesorÃ­a gratuita se agendÃ³ correctamente ğŸ‘ŒğŸ¼
Felicitaciones por dar tu primer paso en el camino de la inversiÃ³n inmobiliaria, estamos para acompaÃ±arte en todo el proceso.
Te esperamos el dÃ­a Martes 14 de Enero a las 19:00 hrs . ğŸ˜

Te dejo un video para que puedas conocernos mejor. 
https://www.instagram.com/reel/CiOHUnaOi5K/ 
Â¡Nos vemos en la asesorÃ­a!
```

**DESPUÃ‰S:**
```
âœ… Â¡Listo {nombre}!

Tu asesorÃ­a quedÃ³ agendada:
ğŸ“… {dia} {fecha} a las {hora} hrs
ğŸ’» Videollamada (link llegarÃ¡ 30 min antes)

Felicitaciones por tu primer paso en inversiÃ³n inmobiliaria ğŸ‰

Mientras tanto, conoce mÃ¡s sobre nosotros:
ğŸ¥ https://www.instagram.com/reel/CiOHUnaOi5K/

Â¡Nos vemos!
```

---

### ğŸ“© **8. ConfirmaciÃ³n dÃ­a de la AsesorÃ­a (MEJORADO)**

**ANTES:**
```
Buen dÃ­a "NOMBRE" como estas??
Â¿Confirmas tu asistencia a la asesorÃ­a de hoy a las 19:00 hrs verdad? 

Tu asesor ya tiene todo preparado para ti. ğŸ˜‰
```

**DESPUÃ‰S:**
```
Buenos dÃ­as {nombre} ğŸ˜Š

Â¿Confirmas para hoy a las {hora} hrs?

Tu asesor ya tiene todo listo para mostrarte las mejores opciones.

Solo responde "sÃ­" para confirmar.
```

---

### ğŸ“© **9. EnvÃ­o de Link Google Meet (MEJORADO)**

**ANTES:**
```
Hola "NOMBRE", te dejo el link de Google Meet para tu asesorÃ­a de inversiÃ³n con Activo MÃ¡s. 

https://meet.google.com/wzf-qhqt-jbg?authuser=0

Nos vemos a las 13:00hrs ğŸ˜‰ Tu asesor te estarÃ¡ esperando.
```

**DESPUÃ‰S:**
```
Hola {nombre} ğŸ‘‹

Link para tu asesorÃ­a:
ğŸ”— {google_meet_link}

ğŸ“… Hoy a las {hora} hrs
ğŸ‘¤ Te atenderÃ¡ {asesor}

Â¡ConÃ©ctate 5 minutos antes! Nos vemos ğŸ˜Š
```

---

### ğŸ“© **10. Cliente No Contesta Llamados (MEJORADO)**

**ANTES:**
```
Â¡Hola "NOMBRE"! ğŸ‘‹

Soy "Nombre de telemarketing" de Activo MÃ¡s Inversiones (www.activomas.cl).

Te escribo porque completaste el formulario sobre inversiones en departamentos, la idea es agendar una asesorÃ­a inmobiliaria.

CuÃ©ntame si tienes algÃºn horario disponible para llamarte o si prefieres coordinar por este medio.

Quedo atento a tu respuesta. Â¡Saludos!
```

**DESPUÃ‰S:**
```
Hola {nombre} ğŸ˜Š

Soy {agente} de Activo MÃ¡s. IntentÃ© llamarte para coordinar tu asesorÃ­a sobre inversiÃ³n en departamentos.

Â¿Prefieres que coordinemos por acÃ¡ o te llamo en un horario especÃ­fico?

AvÃ­same y agendamos.
```

---

## CAMPOS FALTANTES EN CONFIGURACIÃ“N DEL BROKER

Para soportar este tipo de comunicaciÃ³n personalizada, necesitamos agregar a `BrokerPromptConfig`:

### 1. **InformaciÃ³n de Beneficios/Subsidios**
```python
benefits_info = Column(JSONB, nullable=True)
# Ejemplo:
{
  "bono_pie_0": {
    "name": "Bono Pie 0",
    "description": "No necesitas pago inicial",
    "active": true
  },
  "subsidio_dividendo": {
    "name": "Subsidio al Dividendo",
    "description": "Apoyo mensual para pago del crÃ©dito hipotecario",
    "active": true
  }
}
```

### 2. **Requisitos EspecÃ­ficos**
```python
qualification_requirements = Column(JSONB, nullable=True)
# Ejemplo:
{
  "dicom": {
    "required": "clean",
    "min_months_clean": 12,
    "message": "No estar en DICOM mÃ­nimo 1 aÃ±o"
  },
  "contract": {
    "types": ["indefinido", "boletas"],
    "min_months_indefinido": 3,
    "min_years_boletas": 2,
    "message": "Contrato indefinido (+3 meses) o 2 aÃ±os con boletas"
  },
  "min_income": 1400000,
  "bank_account": {
    "required": true,
    "with_credit_line": true,
    "message": "Cuenta corriente con lÃ­nea de crÃ©dito"
  },
  "visa": {
    "for_foreigners": true,
    "type": "definitiva",
    "message": "Visa definitiva (solo extranjeros)"
  }
}
```

### 3. **Mensajes de Seguimiento Personalizados**
```python
follow_up_messages = Column(JSONB, nullable=True)
# Ejemplo:
{
  "no_response_24h": "Hola {nombre} ğŸ‘‹ Vi que dejaste la conversaciÃ³n a medias...",
  "no_response_48h": "Hola {nombre}, Â¿sigue vigente tu interÃ©s?",
  "appointment_confirmation": "Buenos dÃ­as {nombre} ğŸ˜Š Â¿Confirmas para hoy a las {hora}?",
  "appointment_reminder": "Hola {nombre}, te recuerdo tu asesorÃ­a a las {hora}",
  "post_appointment": "Hola {nombre}, Â¿cÃ³mo te fue en la asesorÃ­a?"
}
```

### 4. **Datos Adicionales a Recopilar**
```python
additional_fields = Column(JSONB, nullable=True)
# Ejemplo:
{
  "age": {"required": true, "min": 18, "max": 80},
  "occupation": {"required": true, "examples": ["empleado", "independiente", "empresario"]},
  "purpose": {"required": true, "options": ["vivir", "invertir", "ambos"]},
  "current_credits": {
    "ask": true,
    "types": ["consumo", "hipotecario", "automotriz"],
    "track_monthly_amount": true
  },
  "savings_available": {
    "ask": true,
    "for": "pie y gastos iniciales"
  },
  "nationality": {
    "ask_if_foreigner": true,
    "check_visa": true
  }
}
```

### 5. **ConfiguraciÃ³n de Videollamada**
```python
meeting_config = Column(JSONB, nullable=True)
# Ejemplo:
{
  "platform": "google_meet",
  "duration_minutes": 60,
  "buffer_minutes": 15,
  "reminder_times": [1440, 60, 30],  # minutos antes (24h, 1h, 30min)
  "preferred_device": "computador",
  "preparation_instructions": "ConÃ©ctate 5 minutos antes",
  "confirmation_required": true,
  "confirmation_hours_before": 4
}
```

### 6. **Plantillas de Mensajes**
```python
message_templates = Column(JSONB, nullable=True)
# Ejemplo:
{
  "greeting": "Â¡Hola {nombre}! Soy {agente} de {broker_name} ğŸ‘‹",
  "benefits_intro": "Justo ahora hay condiciones muy buenas con {benefits}",
  "appointment_scheduled": "âœ… Â¡Listo {nombre}! Tu asesorÃ­a quedÃ³ agendada: {datetime}",
  "appointment_link": "Link: {meet_url} - Hoy a las {hora} hrs",
  "no_qualified": "Gracias {nombre}. En este momento no cumples con los requisitos mÃ­nimos, pero...",
  "qualified": "Â¡Excelente {nombre}! Cumples con todos los requisitos ğŸ‰"
}
```

---

## RECOMENDACIONES DE IMPLEMENTACIÃ“N

### 1. **Flujo Conversacional Mejorado**
```
Saludo inicial (corto)
  â†“
Validar interÃ©s (antes de requisitos)
  â†“
Mencionar beneficios (Bono Pie 0)
  â†“
Preguntar requisitos UNO POR UNO
  â†“
Calificar lead
  â†“
Si califica â†’ Agendar
  â†“
Confirmar cita
  â†“
Enviar link
```

### 2. **Reglas de Oro**
- âœ… MÃ¡ximo 50 palabras por mensaje
- âœ… Una pregunta a la vez
- âœ… Confirmar antes de avanzar
- âœ… Usar emojis con moderaciÃ³n (1-2 por mensaje)
- âœ… Personalizar con {nombre} siempre
- âœ… Validar interÃ©s ANTES de pedir datos

### 3. **Ajustes en Prompt del Agente**
```python
behavior_rules = """
- Mensajes cortos (mÃ¡x 50 palabras)
- UNA pregunta a la vez
- NO listar todos los requisitos de golpe
- Validar interÃ©s antes de pedir datos sensibles
- Mencionar beneficios (Bono Pie 0, subsidio) naturalmente
- Confirmar cada dato antes de continuar
- Usar {nombre} para personalizar
"""
```

---

## PRÃ“XIMOS PASOS

1. **Crear migraciÃ³n** para agregar campos faltantes a `BrokerPromptConfig`
2. **Actualizar servicio** de construcciÃ³n de prompts para usar nuevos campos
3. **Configurar plantillas** en base de datos para Activo MÃ¡s
4. **Entrenar agente** con nuevo flujo conversacional
5. **Probar** con leads reales y ajustar

Â¿Quieres que implemente estos cambios?
